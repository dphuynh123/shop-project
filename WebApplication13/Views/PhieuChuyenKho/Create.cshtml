@using WebApplication13.Models;

@model IEnumerable<WebApplication13.Models.SanPham>

@{
        Layout = "~/Views/Layout/_LayoutAdminNew.cshtml";   
}

@using (Html.BeginForm("LapPhieu", "PhieuChuyenKho"))
{
    @Html.AntiForgeryToken()
    <div class="container-fluid">
        <div class="container-fluid">
            <div class="row">

                <div class="col-md-12">
                    <div class="card" style="margin-bottom:unset">
                        <div class="card-header card-header-icon card-header-info">
                            <div class="card-icon">
                                <div style="font-size:25px" class="font-weight-bolder">
                                    Phiếu Chuyển Kho
                                </div>
                                <div class="ripple-container"></div>
                            </div>
                        </div>
                        <div class="card-body ml-5" style="padding-right:70px">
                            <div class="row">
                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="basic-addon1"><i class="ti-user"></i></span>
                                        </div>
                                        <input type="text" name="inputtext" class="form-control" placeholder="Nhập Mã Sản Phẩm" id="MaSanPham" aria-label="Username" aria-describedby="basic-addon1">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="input-group mb-3 mt-2 mr-1">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="basic-addon1"><i class="ti-user"></i></span>
                                        </div>
                                        <label style="font-size:16px">Số Lượng Hiện Tại: </label>
                                        <div id="SLHT" style="height: 30px; width: 50px; overflow: auto;" class="form-control; mb-1"></div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="input-group mb-3">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="basic-addon1"><i class="ti-user"></i></span>
                                        </div>
                                        <input type="text" name="SLC" placeholder="Nhập Số Lượng Chuyển" id="SLC" class="form-control" />
                                    </div>
                                </div>
                                <div class="row ml-4" id="KhoHang">
                                    <label class="col-form-label" style="font-size:16px">Chuyển đến :</label>
                                    <div>
                                        <div class="form-group bmd-form-group">
                                            @Html.DropDownList("KhoHangId", null, htmlAttributes: new { @class = "form-control", @style = "text-align:center;width:130px" })
                                        </div>
                                    </div>
                                </div>
                                @*<div id="KhoHang">
                                        <div class="form-group">
                                            <div class="input-group mb-3">
                                                <div class="input-group-prepend">
                                                    <span class="input-group-text" id="basic-addon1"><i class="ti-user"></i> </span>
                                                </div>
                                                @Html.DropDownList("KhoHangId", null, htmlAttributes: new { @class = "form-control", @style = "text-align:center; width:130px;display:block" })
                                            </div>
                                        </div>
                                    </div>*@

                                <div id="MSP" style="height: 20px; width: 200px; overflow: auto;" class="form-control" hidden="hidden"></div>
                            </div>
                            <div class="row">

                            </div>
                            <input class="btn btn-info float-right" name="submitButton" id="btnSave" value="Chọn Sản Phẩm" type="button">
                        </div>
                    </div>
                </div>

                @*<div class="col-md-12">
                        <div class="card" style="margin-bottom:unset">
                            <div class="card-header card-header-icon card-header-info">
                                <div class="card-icon">
                                    <div style="font-size:25px" class="font-weight-bolder">
                                        Phiếu Chuyển Kho
                                    </div>
                                </div>
                            </div>
                            <div class="card-body ml-3" style="padding-right:70px">
                                <div class="material-datatables">
                                    <div class="table-responsive" id="selectList" style="display:none">
                                        <table id="zero_config1" class="table table-striped row-border">
                                            <thead style="background-color:bisque;font-size:25px; height:30px" class="text-center">
                                                <tr>
                                                    <th width="250px">Họ tên</th>
                                                    <th width="250px">Số Điện Thoại</th>
                                                    <th width="250px">Cửa Hàng</th>
                                                    <th width="250px">Số Lượng Chuyển</th>
                                                    <th width="250px"></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var item in Model)
                                                {
                                                    <tr style="text-align:center">
                                                        <td class="title">
                                                            @Html.DisplayFor(modelItem => item.MaSanPham)
                                                            <input id="MaSP" style="height: 20px; width: 200px; overflow: auto;" class="form-control" value="@item.SanPhamId" hidden="hidden">
                                                        </td>
                                                        <td>
                                                            @Html.DisplayFor(modelItem => item.TenSP)
                                                        </td>
                                                        <td>
                                                            @Html.DisplayFor(modelItem => item.SoLuong)
                                                        </td>
                                                        <td>
                                                            <input type="text" name="SLC" placeholder="Số Lượng Chuyển" id="SLC" class="form-control" />
                                                        </td>
                                                        <td>
                                                            <input class="btn btn-info float-right" name="submitButton" id="btnSave" value="Chọn Sản Phẩm" type="button">
                                                        </td>
                                                    </tr>
                                                }
                                        </table>
                                    </div>
                                    <div class="row">
                                        <span class="btn btn-info" style="margin-left:45%" id="btnmore">
                                            <i class="material-icons md-48">arrow_drop_down</i>
                                        </span>
                                        <span class="btn btn-info" style="margin-left:45%; display:none" id="btnmore1">
                                            <i class="material-icons md-48">arrow_drop_up</i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>*@




                <div class="card">
                    <div class="card-body ml-5" style="padding-right:70px">
                        <div class="table-responsive">
                            <table id="tblStudent" class="table" style="font-size:18px">
                                <thead class="text-primary">
                                    <tr>
                                        <th class="productth">Mã Sản Phẩm</th>
                                        <th class="productth">Tên Sản Phẩm</th>
                                        <th class="productth">Số Lượng Chuyển</th>
                                    </tr>

                                </thead>
                                <tbody></tbody>
                            </table>

                            @*@if (ViewBag.Check == "True")
                                {
                                    <div id="btnXacNhan" style="display:block">
                                        <hr />
                                        <input class="btn btn-info float-right" value="Lập Phiếu" type="submit">
                                    </div>
                                }
                                else
                                {*@

                            @*}*@

                            <div id="btnXacNhan" style="display:none">
                                <hr />
                                <input class="btn btn-info float-right" value="Lập Phiếu" type="submit">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}

<style type="text/css">
    /*Rules for sizing the icon*/
    .material-icons.md-18 {
        font-size: 18px;
    }

    .material-icons.md-24 {
        font-size: 24px;
    }

    .material-icons.md-36 {
        font-size: 36px;
    }

    .material-icons.md-48 {
        font-size: 48px;
    }
</style>


@section Scripts
{

    <script src="~/Admin/assets/libs/jquery/dist/jquery.min.js"></script>

    <!-- this page js -->
    <script src="~/Admin/assets/extra-libs/multicheck/datatable-checkbox-init.js"></script>
    <script src="~/Admin/assets/extra-libs/multicheck/jquery.multicheck.js"></script>
    <script src="~/Admin/assets/extra-libs/DataTables/datatables.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.10.0.min.js" type="text/javascript"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/jquery-ui.min.js" type="text/javascript"></script>
    <link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.2/themes/blitzer/jquery-ui.css" rel="Stylesheet" type="text/css" />
    <script type="text/javascript">
        $(function () {
            $("#MaSanPham").autocomplete({
                source: function (request, response) {
                    $.ajax({
                        url: '/PhieuChuyenKho/AutoComplete/',
                        data: "{ 'prefix': '" + request.term + "'}",
                        dataType: "json",
                        type: "POST",

                        contentType: "application/json; charset=utf-8",
                        success: function (data) {
                            response($.map(data, function (item) {
                                return item;
                            }))
                        },
                    });
                },
                select: function (event, ui) {
                    TenKH(ui.item.TenKH)
                    log(ui.item.TenKH);
                    log1(ui.item.DC);
                    Sdt(ui.item.Sdt);
                    KHId(ui.item.KHId);
                    MSP(ui.item.MSP);
                    SLHT(ui.item.SLHT);
                },
                minLength: 1
            });
            function log(message) {
                $("<div>").text(message).prependTo("#log");
                $("#log").scrollTop(0);
            }

            function log1(message) {
                $("<div>").text(message).prependTo("#log1");
                $("#log1").scrollTop(0);
            }

            function Sdt(message) {
                $("<div>").text(message).prependTo("#Sdt");
                $("#sdt").scrollTop(0);
            }
            function KHId(message) {
                $("<div>").text(message).prependTo("#KHId");
                $("#KHId").scrollTop(0);
            }
            function TenKH(message) {
                $("<div>").text(message).prependTo("#TenKH");
                $("#TenKH").scrollTop(0);
            }
            function MSP(message) {
                $("<input type='test' class='form-control' id='MaSP'>").text(message).val(message).prependTo("#MSP");
                $("#MSP").scrollTop(0);
            }
            function SLHT(message) {
                $("<div style='font-size:17px; text-align:center' class=''>").text(message).prependTo("#SLHT");
                $("#SLHT").scrollTop(0);
            }
        });
    </script>



    <script type="text/javascript">

            $(function () {
                LoadData();
                $("#btnSave").click(function () {
                    //alert("");

                    var dataObject = JSON.stringify({
                        'pSanPhamId': $("#MaSP").val(),
                        'pSoLuongChuyen': $('#SLC').val(),
                    });
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("ThemPhieuChuyenKho")',
                        data: dataObject,

                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        success: function (d) {
                            //alert("Data has been added successfully.");
                            if (d.message != 'SUCCESS') {
                                alert(d.Message);
                            }
                            LoadData();
                            $("#btnXacNhan").show();
                            $("#KhoHang").hide();
                            $('#MaSanPham').val('');
                            $('#SLC').val('');
                        },
                        error: function () {
                            alert("Error while inserting data");
                        }
                    });
                    return false;
                });
            });

            function LoadData() {
                $("#tblStudent tbody tr").remove();
                $.ajax({
                    type: 'POST',
                    url: '@Url.Action("PhieuCK")',
                    dataType: 'json',
                    data: { id: '' },
                    success: function (data) {
                        var items = '';
                        if (data == null) {
                            var rows = "<tr>"
                                + "<td class='prtoducttd'>" + Null  + "</td>"
                            + "<td class='prtoducttd'>" + Null + "</td>"
                            + "<td class='prtoducttd'>" + Null + "</td>"
                            + "</tr>";
                            $('#tblStudent tbody').append(rows);
                        }
                        else {
                             $.each(data, function (i, item) {
                            var rows = "<tr>"
                            + "<td class='prtoducttd'>" + item.pMaSanPham + "</td>"
                            + "<td class='prtoducttd'>" + item.pTenSP + "</td>"
                            + "<td class='prtoducttd'>" + item.pSoLuongChuyen + "</td>"
                            + "</tr>";
                            $('#tblStudent tbody').append(rows);
                        });
                        }

                    },
                    error: function (ex) {
                        var r = jQuery.parseJSON(response.responseText);
                        alert("Message: " + r.Message);
                        alert("StackTrace: " + r.StackTrace);
                        alert("ExceptionType: " + r.ExceptionType);
                    }
                });
                return false;
            }
    </script>
    <script>
        $(document).ready(function () {
            $("#btnmore").click(function () {
                $("#selectList").slideToggle();
                $("#btnmore").hide();
                $("#btnmore1").show();

            });
            $("#btnmore1").click(function () {
                $("#selectList").slideToggle();
                $("#btnmore").show();
                $("#btnmore1").hide();
            });
        })
    </script>

    @*<script>
            $(document).ready(function () {
                $('#zero_config1').DataTable({
                    "paging": false,
                });
            });
        </script>*@



}
